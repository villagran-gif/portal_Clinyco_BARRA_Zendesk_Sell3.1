diff --git a/server.js b/server.js
index 0709109..c0ffee1 100644
--- a/server.js
+++ b/server.js
@@ -215,7 +215,7 @@ app.get('/api/pipelines', async (_req, res) => {
   try {
-    const items = await getPipelines();
+    const items = (typeof getPipelines === 'function') ? await getPipelines() : null;
     const pipelines = (items || [])
       .map(p => ({ id: p.id, name: p.name, disabled: p.disabled === true }))
       .filter(p => !p.disabled);

     return res.status(200).json({ ok: true, pipelines });
   } catch (err) {
     console.error('pipelines error', err);

-    // Fallback hardcoded list (when token/endpoint fails)
-    const pipelines = [
-      { id: 290779, name: "Pipeline Cirugía Bariátricas", disabled: false },
-      { id: 4823817, name: "Pipeline Balones", disabled: false },
-      { id: 4959507, name: "Pipeline Cirugía Plastica", disabled: false },
-      { id: 5049979, name: "Pipeline Cirugía General", disabled: false },
-    ];
+    // Fallback chain:
+    // 1) If getPipelines() is missing/broken, try getPipelinesByIds() with known IDs
+    // 2) If API access still fails, hardcode a minimal list.
+    let pipelines = [];
+    try {
+      if (typeof getPipelinesByIds === 'function') {
+        const knownIds = [1290779, 4823817, 4959507, 5049979];
+        const items = await getPipelinesByIds(knownIds);
+        pipelines = (items || []).map(p => ({ id: p.id, name: p.name, disabled: p.disabled === true }))
+          .filter(p => !p.disabled);
+      }
+    } catch (_e) {
+      // ignore and use hardcoded below
+    }
+    if (!pipelines.length) {
+      pipelines = [
+        // IMPORTANT: Bariátrica canonical pipeline ID is 1290779 (not 290779)
+        { id: 1290779, name: "Pipeline Cirugía Bariátricas", disabled: false },
+        { id: 4823817, name: "Pipeline Balones", disabled: false },
+        { id: 4959507, name: "Pipeline Cirugía Plastica", disabled: false },
+        { id: 5049979, name: "Pipeline Cirugía General", disabled: false },
+      ];
+    }

     return res.status(200).json({
       ok: true,
       pipelines,
       fallback: true,
       details: err.message || String(err),
     });
   }
 });

@@ -536,19 +536,6 @@ app.post('/api/create-contact', async (req, res) => {
   const dryRun = String(req.query.dry_run || '').toLowerCase() === '1' || String(req.query.dry_run || '').toLowerCase() === 'true';
   const debug = String(req.query.debug || '').toLowerCase() === '1' || String(req.query.debug || '').toLowerCase() === 'true';

-  // Safety switch (unless dry-run)
-  if (!dryRun && String(process.env.ALLOW_WRITE || 'false').toLowerCase() !== 'true') {
-    return res.status(403).json({
-      ok: false,
-      status: 403,
-      error: 'WRITE_DISABLED',
-      message: 'Creación deshabilitada en este entorno (ALLOW_WRITE != true).',
-    });
-  }
-
   // Always reply with stable shape
   const out = (status, error = null, message = null, extra = {}) => {
     return res.status(status).json({
       ok: status < 400,
@@ -718,6 +705,31 @@ app.post('/api/create-contact', async (req, res) => {
     if (debug) { detalle_tecnico.payload = payload; }

+    // If write is disabled, still return a helpful preview (instead of "Sin datos")
+    if (!dryRun && String(process.env.ALLOW_WRITE || 'false').toLowerCase() !== 'true') {
+      return out(403, 'WRITE_DISABLED', 'Creación deshabilitada en este entorno (ALLOW_WRITE != true).', {
+        rut_input: rutInput,
+        rut_normalizado: rutNoDashLower,
+        rut_humano: rutHuman,
+        vista_previa,
+        detalle_tecnico,
+        payload,
+      });
+    }
+
     if (dryRun) {
       return out(200, null, 'DRY_RUN: payload construido (no se creó contacto).', {
         rut_input: rutInput,
         rut_normalizado: rutNoDashLower,
         rut_humano: rutHuman,
         comuna,
         payload,
       });
     }

     // Create
     try {
       const created = await createContact(payload);
@@ -860,19 +872,6 @@ app.post('/api/create-deal', async (req, res) => {
   const dryRun = String(req.query.dry_run || '').toLowerCase() === '1' || String(req.query.dry_run || '').toLowerCase() === 'true';
   const debug = String(req.query.debug || '').toLowerCase() === '1' || String(req.query.debug || '').toLowerCase() === 'true';

-  // Safety switch (unless dry-run)
-  if (!dryRun && String(process.env.ALLOW_WRITE || 'false').toLowerCase() !== 'true') {
-    return res.status(403).json({
-      ok: false,
-      status: 403,
-      error: 'WRITE_DISABLED',
-      message: 'Creación deshabilitada en este entorno (ALLOW_WRITE != true).',
-    });
-  }
-
   const out = (status, error = null, message = null, extra = {}) => {
     return res.status(status).json({
       ok: status < 400,
@@ -1108,6 +1107,15 @@ app.post('/api/create-deal', async (req, res) => {
     const payload = { data: { name: dealName, contact_id: contactId, owner_id: ownerId, custom_fields,
       estatura: estaturaRaw || null,
       peso: pesoRaw || null,
@@ -1129,6 +1137,17 @@ app.post('/api/create-deal', async (req, res) => {
  ...(stageId ? { stage_id: stageId } : {}) } };
     if (debug) detalle_tecnico.payload = payload;

+    // If write is disabled, still return a helpful preview (instead of "Sin datos")
+    if (!dryRun && String(process.env.ALLOW_WRITE || 'false').toLowerCase() !== 'true') {
+      return out(403, 'WRITE_DISABLED', 'Creación deshabilitada en este entorno (ALLOW_WRITE != true).', {
+        vista_previa,
+        detalle_tecnico,
+        payload,
+      });
+    }
+
     if (dryRun) {
       return out(200, null, 'Vista previa de Deal (dry_run).', { vista_previa, detalle_tecnico });
     }

diff --git a/lib/sell.js b/lib/sell.js
index 1111111..2222222 100644
--- a/lib/sell.js
+++ b/lib/sell.js
@@ -1,6 +1,20 @@
 // existing code...

+// Pipelines helper (used by /api/pipelines)
+// Returns an array of pipeline objects (data only)
+async function getPipelines() {
+  const data = await sellFetch('/v2/pipelines?per_page=200&sort_by=name');
+  // sellFetch returns parsed JSON, usually { items: [{data: ...}] }
+  const items = (data && data.items) ? data.items : [];
+  return items.map((it) => it.data).filter(Boolean);
+}
+
 // existing code continues...

 module.exports = {
   // existing exports...
+  getPipelines,
 };
